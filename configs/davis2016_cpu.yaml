seed: 0

davis_root: "/content/drive/MyDrive/DAVIS_unzipped/DAVIS"
res: "480p"
base_out: "/content/drive/MyDrive/pr2drag_data"

splits:
  train: "ImageSets/480p/train.txt"
  val: "ImageSets/480p/val.txt"

stage1:
  cache: true
  # label: 1 if synthetic tracker error <= label_err_thresh (px)
  label_err_thresh: 50.0
  # synthetic noise levels (px)
  noise:
    base_sigma: 4.0
    occl_sigma: 220.0
    blur_sigma: 120.0
    motion_sigma: 0.35
    seed_offset: 123

stage2:
  cache: true
  # "a" => 5 dims, "b" => 7 dims
  feat_mode: "b"

stage3:
  out_dir: "davis2016_stage3_fixed"

  tau_target_frac: 0.10
  tau_mode: risk          # 关键：从 quantile 改为 risk-constrained
  tau_risk: 0.02
  tau_min_keep_frac: 0.05 # 至少保留 5% 帧，避免极端阈值把样本吃没
  tau_min: 1e-6
  tau_max: 0.999999

  w_calibration:
    enable: true
    method: isotonic
    bins: 50

  feature_scaler:
    enable: true
    type: robust_iqr
    clip: 8.0
    eps: 1e-6


  hmm:
    prior_good: 0.85
    p_stay_good: 0.92
    p_stay_bad: 0.92
    eps: 1e-3  

  emission:
    scaler:
      enable: true
      clip: 8.0
    calibration:
      enable: true
      eps: 1e-6

  oracle:
    enable: true
    source: y
    tau: 0.5

  aob:
    abstain_mode: linear
    max_bridge_len: 0 
    eps_gate: 0.0   
    eta_L: 0.0           
    eta_u: 0.0       
    max_bridge_len: 999

    bridge_mode: hermite
    hermite_scan: 6
    clamp_hermite: true
    clamp_margin_px: 0.0
    
  metrics:
    fail_px: 50.0

  analysis:
    write_csv: true
    write_figs: true
    log_to_file: true
    archive:
      enable: true
      pack_root: "_paperpack"   # 相对 base_out；也可以写绝对路径
      zip: true
      copy_out_dir: false       # 默认只打包 _analysis；如想把整个 out_dir 也复制进去就改 true

  segment_routing:
    enable: true
    mode: train_quantile          # fixed | train_quantile
    disp_norm_q: 0.95             # 训练集上 boundary_disp_norm 的分位数阈值
    disp_norm: null               # mode=fixed 时用这个（0~1 归一化）
    Lmax: 10                      # 段长度阈值，默认建议 <= max_bridge_len
    require_both_sides: true      # 没有左右边界就强制 abstain（更安全）
    use_speed: false
    speed_norm_q: 0.97
    speed_norm: null
